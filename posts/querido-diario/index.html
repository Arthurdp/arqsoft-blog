<!doctype html>

<html lang="en">

<head>
  <title>Documento arquitetural do Querido Diário - Arquitetura de Software</title>
  <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="Documentação arquitetural produzida pelas turmas de Arquitetura de Software - Computação @ UFCG." />
<meta name="author" content="Example" /><meta property="og:title" content="Documento arquitetural do Querido Diário" />
<meta property="og:description" content="Autor Este documento foi produzido por Matheus Alves dos Santos.
 Matrícula: 117110503 Contato: matheus.santos@ccc.ufcg.edu.br Projeto documentado: https://github.com/okfn-brasil/querido-diario  Descrição Arquitetural &ndash; Querido Diário  Este documento descreve a arquitetura do projeto Querido Diário da Open Knowledge Brasil, baseando-se especialmente no modelo C4." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://joaoarthurbm.github.io/arqsoft-blog/posts/querido-diario/" />
<meta property="article:published_time" content="2020-10-12T00:00:00-03:00" />
<meta property="article:modified_time" content="2020-10-12T00:00:00-03:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Documento arquitetural do Querido Diário"/>
<meta name="twitter:description" content="Autor Este documento foi produzido por Matheus Alves dos Santos.
 Matrícula: 117110503 Contato: matheus.santos@ccc.ufcg.edu.br Projeto documentado: https://github.com/okfn-brasil/querido-diario  Descrição Arquitetural &ndash; Querido Diário  Este documento descreve a arquitetura do projeto Querido Diário da Open Knowledge Brasil, baseando-se especialmente no modelo C4."/>

<meta name="generator" content="Hugo 0.75.1" />
    

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://joaoarthurbm.github.io/arqsoft-blog/fontawesome/css/all.min.css" />
  
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda" />
  
  
  <link rel="stylesheet" type="text/css" href="https://joaoarthurbm.github.io/arqsoft-blog/css/styles.css" /></head>

<body>
  <div id="container">
    <header>
      <h1>
                <a href="https://joaoarthurbm.github.io/arqsoft-blog/">Arquitetura de Software</a>
            </h1>

      <ul id="social-media">
             <li>
               <a href="https://github.com/joaoarthurbm/arqsoft-blog" title="GitHub">
               <i class="fab fa-github fa-lg"></i>
               </a>
             </li>
      </ul>
      
      <p><em>Conteúdo produzido pelas turmas de Arquitetura de Software - Computação @ UFCG</em></p>
      
    </header>

    
<nav>
    <ul>
        
    </ul>
</nav>


    <main>




<article>

    <h1>Documento arquitetural do Querido Diário</h1>

    
      <aside>
    <ul>
        <li>
            <time class="post-date" datetime="2020-10-12T00:00:00-03:00">Oct 12, 2020</time>
        </li>
        

        

        <li>8 minutes read</li>
    </ul>
</aside>

    

    


    <hr>
<h1 id="autor">Autor</h1>
<p>Este documento foi produzido por Matheus Alves dos Santos.</p>
<ul>
<li>Matrícula: 117110503</li>
<li>Contato: <a href="mailto:matheus.santos@ccc.ufcg.edu.br">matheus.santos@ccc.ufcg.edu.br</a></li>
<li>Projeto documentado: <a href="https://github.com/okfn-brasil/querido-diario">https://github.com/okfn-brasil/querido-diario</a></li>
</ul>
<h1 id="descrição-arquitetural----querido-diário">Descrição Arquitetural &ndash; Querido Diário</h1>
<div align="center" style="margin-top:1.5rem;">
    <img src="logo.png" style="width:20rem;">
</div>
<p>Este documento descreve a arquitetura do projeto <a href="https://github.com/okfn-brasil/querido-diario">Querido Diário</a> da <em><a href="https://github.com/okfn-brasil">Open Knowledge Brasil</a></em>, baseando-se especialmente no modelo <a href="https://c4model.com/">C4</a>.</p>
<p>É importante ressaltar que o Querido Diário é composto por módulos cujas implementações estão em repositórios à parte do principal. Por isso, este documento incluirá módulos como a <a href="https://github.com/okfn-brasil/querido-diario-api">API do Querido Diário</a> e o serviço de <a href="https://github.com/okfn-brasil/busca-querido-diario">Busca por Palavras-Chave</a>. Em contrapartida, o conteúdo de repositórios relacionados que não têm impacto direto no sistema, como o site de divulgação do projeto, não será incluído.</p>
<h2 id="descrição-geral-e-objetivos">Descrição Geral e Objetivos</h2>
<p>Os Diários Oficiais estão entre as melhores fontes de informação sobre as ações da administração pública brasileira, especialmente por sua granularidade, existindo até mesmo no âmbito municipal. Contudo, mesmo com a <a href="https://www.gov.br/acessoainformacao/pt-br">Lei de Acesso à Informação</a> vigente, a maioria destas publicações não está disponível em formatos adequados. Elas são encontradas quase exclusivamente em formato PDF.</p>
<p>Nesse cenário, o Querido Diário visa rastrear as fontes destas publicações nos 5.570 municípios brasileiros, extrair as informações ali contidas e, posteriormente, disponibilizá-las na forma de dados abertos.</p>
<p>Ao criar uma fonte confiável e centralizada para estas informações, o Querido Diário busca auxiliar a sociedade civil no acompanhamento dos atos públicos municipais, bem como fomentar avanços nas ferramentas de fiscalização da administração pública brasileira.</p>
<h2 id="contexto">Contexto</h2>
<p>Os usuários do Querido Diário formam um grupo muito heterogêneo, contemplando desde servidores públicos e jornalistas até organizações não governamentais de controle social. De forma geral, todos os cidadãos que busquem acesso aos atos públicos dos municípios brasileiros são potenciais usuários deste <em>software</em>.</p>
<p>Ainda assim, é possível dividi-los em dois grupos principais: a <strong>sociedade civil</strong> e as <strong>ferramentas de fiscalização da administração pública</strong>. Ambos utilizam o Querido Diário como fonte centralizada e confiável de informação acerca dos Diários Oficiais municipais. Contudo, diferenciam-se à medida que as ferramentas de fiscalização não usam os dados disponibilizados apenas como fonte de informação. Elas vão além, aplicando-os na identificação de padrões, detecção de problemas e promoção de impactos positivos na administração pública das cidades brasileiras.</p>
<p>Para atender às demandas desses dois grupos de usuários, o Querido Diário precisa acessar uma grande quantidade de <strong>portais dos poderes públicos municipais</strong> nos quais os Diários Oficiais são disponibilizados. A partir dos documentos encontrados, as informações de interesse são extraídas e estruturadas adequadamente para que possam ser, posteriormente, disponibilizadas.</p>
<p>O diagrama apresentado na Figura 1 descreve sucintamente o contexto em que o Querido Diário está inserido.</p>
<div align="center" style="margin:2rem 0;">
    <img src="diagrama-contexto.png" style="width:95%;">
    <span style="display:block;font-weight:bold;">
        Figura 1 - Diagrama de contexto do Querido Diário
    </span>
</div>
<h2 id="containers"><em>Containers</em></h2>
<p>O Querido Diário é composto atualmente pelos quatro <em>containers</em> que serão descritos a seguir.</p>
<p>O <strong>Raspador de Diários Oficiais</strong> é o <em>container</em> responsável por acessar os portais do poder público onde são disponibilizados os Diários Oficiais municipais, bem como por extrair as informações de interesse sobre estes documentos. Ele foi implementado em <a href="https://www.python.org/">Python</a>, mais especificamente através das bibliotecas <a href="https://www.sqlalchemy.org/">SQLAlchemy</a> e <a href="https://scrapy.org/">Scrapy</a>. Este <em>container</em> se comunica com os portais do poder público através de requisições HTTP e aplica rotinas de pré-processamento nos dados (por meio de <em>middleware</em>) antes de enviá-los para o armazenamento usando <em>Data Mappers</em>.</p>
<p>O <strong>Pré-Processador de Dados</strong> é o <em>container</em> responsável por aplicar transformações aos dados brutos extraídos dos Diários Oficiais, colocando-os em um formato estruturado, acessível e mais amigável à compreensão humana. Ele foi implementado em <a href="https://www.python.org/">Python</a> e disponibiliza diversas rotinas de tratamento e limpeza de dados, sendo utilizado como um <em>middleware</em>.</p>
<p>O <strong>Banco de Dados</strong> é o <em>container</em> responsável por armazenar, de forma estruturada, todas as informações extraídas a partir dos Diários Oficiais municipais. Ele foi implementado em <a href="https://www.postgresql.org/">PostgreSQL</a> e outros <em>containers</em> utilizam <em>Data Mappers</em> para acessá-lo.</p>
<p>A <strong>API do Querido Diário</strong> é o <em>container</em> que viabiliza o acesso externo e eficiente aos dados armazenados no banco de dados. Ela foi implementada em <a href="https://www.python.org/">Python</a>, mais especificamente através das bibliotecas <a href="https://elasticsearch-py.readthedocs.io/en/master/">Elastic Search</a>, <a href="https://fastapi.tiangolo.com/">Fast-API</a> e <a href="https://www.sqlalchemy.org/">SQLAlchemy</a>. Foram utilizados padrões REST e o acesso a esta API se dá por meio de requisições HTTP em formato JSON. Os dois <em>endpoints</em> disponíveis atualmente estão descritos a seguir.</p>
<p><strong><code>GET /gazzettes/</code></strong></p>
<ul>
<li>
<p><strong>Descrição:</strong> Retorna informações sobre os Diários Oficiais que atendam às características descritas no <em>payload</em> da requisição.</p>
</li>
<li>
<p><strong>Atributos do <em>Payload</em></strong></p>
<ul>
<li><strong><code>since</code>:</strong> Data mínima de publicação dos Diários Oficiais a serem retornados.</li>
<li><strong><code>until</code>:</strong> Data máxima de publicação dos Diários Oficiais a serem retornados.</li>
<li><strong><code>keywords</code>:</strong> Lista das palavras-chave que os Diários Oficiais retornados devem conter.</li>
<li><strong><code>page</code>:</strong> Número da página de resultados a ser retornada.</li>
<li><strong><code>page_size</code>:</strong> Tamanho da página de resultados a ser retornada.</li>
</ul>
</li>
<li>
<p><strong>Exemplo de <em>Payload</em></strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{ 
    <span style="color:#f92672">&#34;since&#34;</span>: <span style="color:#e6db74">&#34;2020-09-01&#34;</span>,
    <span style="color:#f92672">&#34;until&#34;</span>: <span style="color:#e6db74">&#34;2020-10-01&#34;</span>,
    <span style="color:#f92672">&#34;keywords&#34;</span>: [<span style="color:#e6db74">&#34;queimadas&#34;</span>],
    <span style="color:#f92672">&#34;page&#34;</span>: <span style="color:#ae81ff">1</span>,
    <span style="color:#f92672">&#34;page_size&#34;</span>: <span style="color:#ae81ff">10</span>
}
</code></pre></div></li>
</ul>
<p><strong><code>GET /gazzettes/&lt;territory_id&gt;</code></strong></p>
<ul>
<li>
<p><strong>Descrição:</strong> Retorna informações sobre os Diários Oficiais que atendam às características descritas no <em>payload</em> da requisição e que sejam do município cujo código no IBGE é igual ao <strong>territory_id</strong>.</p>
</li>
<li>
<p><strong>Atributos do <em>Payload</em></strong></p>
<ul>
<li><strong><code>since</code>:</strong> Data mínima de publicação dos Diários Oficiais a serem retornados.</li>
<li><strong><code>until</code>:</strong> Data máxima de publicação dos Diários Oficiais a serem retornados.</li>
<li><strong><code>keywords</code>:</strong> Lista das palavras-chave que os Diários Oficiais retornados devem conter.</li>
<li><strong><code>page</code>:</strong> Número da página de resultados a ser retornada.</li>
<li><strong><code>page_size</code>:</strong> Tamanho da página de resultados a ser retornada.</li>
</ul>
</li>
<li>
<p><strong>Exemplo de <em>Payload</em></strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{ 
    <span style="color:#f92672">&#34;since&#34;</span>: <span style="color:#e6db74">&#34;2020-03-01&#34;</span>,
    <span style="color:#f92672">&#34;until&#34;</span>: <span style="color:#e6db74">&#34;2020-08-01&#34;</span>,
    <span style="color:#f92672">&#34;keywords&#34;</span>: [<span style="color:#e6db74">&#34;medidas&#34;</span>, <span style="color:#e6db74">&#34;covid-19&#34;</span>],
    <span style="color:#f92672">&#34;page&#34;</span>: <span style="color:#ae81ff">5</span>,
    <span style="color:#f92672">&#34;page_size&#34;</span>: <span style="color:#ae81ff">100</span>
}
</code></pre></div></li>
</ul>
<p>O diagrama apresentado na Figura 2 descreve os <em>containers</em> que compõem o Querido Diário.</p>
<div align="center" style="margin:2rem 0;">
    <img src="diagrama-containers.png" style="width:95%;">
    <span style="display:block;font-weight:bold;">
        Figura 2 - Diagrama de <i>containers</i> do Querido Diário
    </span>
</div>
<p>Além destes <em>containers</em>, futuramente serão implementados outros dois: um para o <em><strong>Front-End</strong></em>, que permitirá o acesso facilitado aos resultados e informações do Querido Diário, e um para <strong>Processamento de Linguagem Natural</strong>, que permitirá a execução de algoritmos de Inteligência Artificial com os dados extraídos.</p>
<h3 id="implantação">Implantação</h3>
<p>Até a conclusão deste documento, o processo de implantação do Querido Diário não havia sido concluído e, portanto, nem todas as decisões sobre este tópico estavam disponíveis.</p>
<p>Contudo, já se sabe que o serviço <a href="https://www.digitalocean.com/products/spaces/">Spaces Object Storage</a> da <a href="https://www.digitalocean.com/">Digital Ocean</a> será utilizado para a hospedagem de todos os arquivos e que a integração contínua com o código hospedado no <a href="https://github.com/">GitHub</a> será feita por meio do <a href="https://hub.docker.com/">Docker Hub</a>.</p>
<h2 id="componentes">Componentes</h2>
<p>Observando a arquitetura do Querido Diário em mais detalhes, os <em>containers</em> descritos anteriormente podem ser subdivididos em componentes.</p>
<p>No Raspador de Diários Oficiais, o componente mais importante talvez seja o <strong>Extrator de Documentos</strong>. Ele é formado por um extenso conjunto de <em>spiders</em> do <a href="https://scrapy.org/">Scrapy</a> que, através de requisições HTTP, recuperam os arquivos dos Diários Oficiais municipais no formato em que estão disponibilizados. Já o componente <strong>Raspador de Dados</strong> é aquele responsável por identificar e executar a forma mais adequada de raspagem das informações contidas nestes arquivos.</p>
<p>É durante essa raspagem de dados que ocorre o uso (como <em>middleware</em>) do Pré-Processador de Dados ou, mais especificamente, do conjunto de <strong>Rotinas de Tratamento de Dados</strong> implementadas em <a href="https://www.python.org/">Python</a> que o compõe. Esses componentes são responsáveis por garantir que, uma vez extraídos, os dados assumam a forma acessível e amigável que se espera deles. A partir deste ponto, o componente <strong>Modelador de Dados</strong> irá garantir que os dados sejam armazenados, estruturando-os adequadamente e enviando-os ao Banco de Dados por meio de <em>Data Mappers</em> do <a href="https://www.sqlalchemy.org/">SQLAlchemy</a>.</p>
<p>Já na API do Querido Diário, é possível identificar dois componentes principais. O primeiro deles, a <strong>Interface de Acesso</strong>, utiliza o <a href="https://fastapi.tiangolo.com/">Fast-API</a> para manipular as requisições HTTP recebidas e extrair os parâmetros de consulta que serão encaminhandos ao Buscador de Dados. Além disso, também é este componente que envia os resultados das consultas aos usuários que realizaram as requisições à API do Querido Diário.</p>
<p>Por fim, o <strong>Buscador de Dados</strong> é o componente responsável por recuperar o conjunto de dados que atenda às especificações dos parâmetros de consulta recebidos. Para isso, o acesso ao Banco de Dados utiliza o <a href="https://elasticsearch-py.readthedocs.io/en/master/">Elastic Search</a> e os <em>Data Mappers</em> do <a href="https://www.sqlalchemy.org/">SQLAlchemy</a>, permitindo que mesmo consultas complexas (como a busca por palavras-chave nos documentos) sejam executadas de forma eficiente.</p>
<p>O diagrama apresentado na Figura 3 descreve os componentes do Querido Diário que foram citados ao longo desta seção.</p>
<div align="center" style="margin:2rem 0;">
    <img src="diagrama-componentes.png" style="width:95%;">
    <span style="display:block;font-weight:bold;">
        Figura 3 - Diagrama de componentes do Querido Diário
    </span>
</div>
<h2 id="visão-da-informação">Visão da Informação</h2>
<p>Apesar da grande quantidade de dados que é manipulada pelo Querido Diário, todas as informações podem ser centralizadas no conceito de Diário Oficial.</p>
<p>Inicialmente, o Diário Oficial é um documento <strong>disponibilizado</strong> em algum portal de poder público municipal, geralmente em formatos pouco amigáveis ao processamento por máquina (como PDFs). Por isso, a primeira atividade do Querido Diário é acessá-lo e obtê-lo. Uma vez que o documento foi <strong>recuperado</strong>, as informações de interesse contidas nele precisam ser &ldquo;raspadas&rdquo;, de modo que o sistema passe a lidar apenas com esse conjunto de dados <strong>extraído</strong>. Durante este processo, o conjunto de dados ainda deve sofrer diversas transformações para que se torne mais acessível e compreensível, ou seja, se torne <strong>tratado</strong>.</p>
<p>Com essas etapas concluídas, o Diário Oficial pode finalmente ser <strong>armazenado</strong> no banco de dados do Querido Diário, onde permanecerá indefinidamente. Finalmente, todas as publicações de Diários Oficiais que forem armazenadas pelo Querido Diário poderão ser <strong>requisitadas</strong> por qualquer indivíduo que tenha interesse em conhecer mais sobre os atos do poder público nos municípios brasileiros.</p>
<p>O fluxo de informações descrito nesta seção está apresentado no diagrama de estados da Figura 4.</p>
<div align="center" style="margin:2rem 0;">
    <img src="visao-informacao.png" style="width:95%;">
    <span style="display:block;font-weight:bold;">
        Figura 4 - Visão da Informação dos Diários Oficiais no Querido Diário
    </span>
</div>


</article>


<section class="post-nav">
    <ul>
        
        <li>
            <a href="https://joaoarthurbm.github.io/arqsoft-blog/posts/eureca-da_coleta_de_dados_ao_backend/"><i class="fa fa-chevron-circle-left"></i> Projeto Eureca - Da coleta de dados ao backend</a>
        </li>
        
        
        <li>
            <a href="https://joaoarthurbm.github.io/arqsoft-blog/posts/farolcovid/">Documentação arquitetural para o projeto Farol Covid <i class="fa fa-chevron-circle-right"></i> </a>
        </li>
        
    </ul>
</section>
  
    
    
  





</main>
    <footer>
        <h6>Copyright © Turma de Arquitetura de Software UFCG |
            Rendered by <a href="https://gohugo.io" title="Hugo">Hugo</a> |
            <a href="https://joaoarthurbm.github.io/arqsoft-blogindex.xml">Subscribe </a></h6>
    </footer>
</div>
<script src="https://joaoarthurbm.github.io/arqsoft-blog/js/scripts.js"></script>

</body>

</html>

